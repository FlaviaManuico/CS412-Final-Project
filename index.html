<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cosmic Solar System</title>
    <link rel="stylesheet" href="css/style.css">

    <!-- Matrix & math utilities -->
    <script src="js/transformations.js"></script>

    <!-- ===== VERTEX SHADER ===== -->
    <script id="vs" type="x-shader/x-vertex">#version 300 es
    layout(location = 0) in vec4 aPosition;
    layout(location = 1) in vec3 aNormal;
    layout(location = 2) in vec2 aUV;

    uniform mat4 uModel;
    uniform mat4 uView;
    uniform mat4 uProjection;
    uniform mat4 uNormalMatrix;

    out vec3 vNormal;
    out vec3 vPosition;
    out vec2 vTexCoord;

    void main() {
        vNormal = mat3(uNormalMatrix) * aNormal;
        vPosition = (uModel * aPosition).xyz;
        vTexCoord = aUV;
        gl_Position = uProjection * uView * uModel * aPosition;
    }
    </script>

    <!-- ===== FRAGMENT SHADER ===== -->
    <script id="fs" type="x-shader/x-fragment">#version 300 es
    precision mediump float;

    in vec3 vNormal;
    in vec3 vPosition;
    in vec2 vTexCoord;

    uniform vec3 uLightPos;
    uniform vec3 uColor;
    uniform float uEmissive;

    uniform sampler2D uTexture;
    uniform sampler2D uBumpMap;
    uniform int useTexture;
    uniform int useBump;

    out vec4 fragColor;

    void main() {
        if (uEmissive > 0.5) {
            vec3 baseColor = (useTexture == 1) ? texture(uTexture, vTexCoord).rgb : uColor;
            fragColor = vec4(baseColor * uEmissive, 1.0);
            return;
        }

        vec3 N = normalize(vNormal);
        if (useBump == 1) {
            vec3 bump = texture(uBumpMap, vTexCoord).rgb;
            bump = bump * 2.0 - 1.0;
            N = normalize(N + bump * 0.5);
        }

        vec3 L = normalize(uLightPos - vPosition);
        float diffuse = max(dot(N, L), 0.0);
        float ambient = 0.45;
        float lightFactor = ambient + diffuse * 0.45;

        vec3 texColor = (useTexture == 1) ? texture(uTexture, vTexCoord).rgb : uColor;

        fragColor = vec4(texColor * lightFactor, 1.0);
    }
    </script>
</head>

<body>

    <canvas id="glcanvas"
        style="width: 100vw; height: 100vh; display: block;"></canvas>

    <div class="control-column">
        <button id="cockpit-toggle" class="control-button">
            Enter Cockpit
        </button>

        <button id="game-mode-toggle" class="control-button" disabled>
            Enter Game Mode
        </button>

        <button id="add-asteroids-btn" class="control-button">
            Add Asteroids
        </button>
    </div>

    <!-- Planet Info Panel -->
    <div id="planet-info" style="
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px;
        border-radius: 8px;
        display: none;
        max-width: 250px;
        font-family: Arial, sans-serif;
        z-index: 100;
    ">
        <h3 id="info-name" style="margin: 0 0 5px 0;"></h3>
        <p id="info-text" style="margin: 0;"></p>
        <button id="info-close" style="
            background: red;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 5px;
        ">X</button>
    </div>

    <div id="cockpit-window-frame">
        <div class="cockpit-ring"></div>
    </div>

    <div id="cockpit-joystick">
        <div id="joystick-base"></div>
        <div id="joystick-stick"></div>
    </div>
    <div id="score-board">
        Score: 0
    </div>

    <div id="visual-controls">
        <h3>Visual Controls</h3>
        <!-- Sun Brightness -->
        <div class="slider-row">
            <label>
            <span>Sun Brightness</span>
            <span id="sun-brightness-value">1.8</span>
            </label>
            <input type="range" id="sun-brightness"
                min="0.5" max="5.0" step="0.1" value="1.8">
        </div>

        <!-- Orbit Speed -->
        <div class="slider-row">
            <label>
            <span>Orbit Speed</span>
            <span id="orbit-speed-value">1.0x</span>
            </label>
            <input type="range" id="orbit-speed"
                min="0.2" max="2.0" step="0.1" value="1.0">
        </div>
    </div>

    <!-- Windows -->
    <div id="intro-modal" class="modal-overlay">
    <div class="modal-content">
        <h1>Cosmic Solar System</h1>
        <p>Welcome aboard, pilot!</p>
        <p>
        Explore an interactive 3D solar system where you can observe the planets, enter the cockpit of your ship, and experience space from a first-person view.</p>
        <p>Use the Visual Controls panel to adjust the Sun’s brightness and the orbit speed, then jump into the cockpit to start your space journey.</p>
        <button id="intro-start-btn" class="modal-button">
        Start Exploration
        </button>
    </div>
    </div>

    <!-- Cockpit Instructions -->
    <div id="cockpit-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h2>Cockpit Instructions</h2>
        <p>You are now entering the pilot’s seat of your ship.</p>
        <p>Use these controls to move around the solar system and explore from a first-person view:</p>
        <p>You can still click on planets to open their information cards while you are in the cockpit view.</p>
        <p><b>W / S</b> – Move Forward / Backward</p>
        <p><b>A / D</b> – Strafe left / right</p>
        <p><b>SPACE</b> – Move up &nbsp;&nbsp;<b>SHIFT</b> – Move down</p>
        <p><b>← →</b> Arrow keys – Rotate the ship left / right</p>
        <button id="cockpit-ok-btn" class="modal-button">
        Got it, let's fly!
        </button>
    </div>
    </div>

    <!-- Game Mode Start Window-->
    <div id="game-start-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h2>Game Mode</h2>
        <p>
        Game Mode adds a simple arcade challenge on top of the solar system simulation.</p> 
        <p>While you are in the cockpit:</p>
        <p><b>Asteroids will appear in front of your ship.</b></p>
        <p><b>Move and dodge them to avoid a collision.</b></p>
        <p><b>Each asteroid you avoid increases your score.</b></p>
        <p>Try to stay alive as long as you can and reach the highest possible score before your ship is hit.</p>
        <button id="game-start-ok-btn" class="modal-button">
        Start Game
        </button>
    </div>
    </div>

    <!-- Game Over -->
    <div id="game-over-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h2>Game Over</h2>
        <p>Your ship has been hit by an asteroid.</p>
        <p>Your final score: <span id="final-score">0</span></p>
        <button id="game-retry-btn" class="modal-button">
        Try Again
        </button>
    </div>
    </div>


    <!-- Scripts -->
    <script src="js/planets.js"></script>
    <script src="js/scene.js"></script>
    <script src="js/main.js"></script>
    <script src="js/interaction.js"></script>

    <script>
        // Close info panel
        document.getElementById('info-close').addEventListener('click', () => {
            document.getElementById('planet-info').style.display = 'none';
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Sun Brightness
            const sunSlider = document.getElementById('sun-brightness');
            const sunValue = document.getElementById('sun-brightness-value');
            if(sunSlider) {
                sunSlider.addEventListener('input', (e) => {
                    window.sunBrightness = parseFloat(e.target.value);
                    sunValue.textContent = window.sunBrightness.toFixed(1);
                });
            }

        // Orbit Speed
        const orbitSlider = document.getElementById('orbit-speed');
        const orbitValue = document.getElementById('orbit-speed-value');
            if(orbitSlider) {
                orbitSlider.addEventListener('input', (e) => {
                    window.orbitSpeedMultiplier = parseFloat(e.target.value);
                    orbitValue.textContent = window.orbitSpeedMultiplier.toFixed(1) + 'x';
                });
            }
        });

    // Windows
    const introModal      = document.getElementById("intro-modal");
    const introStartBtn   = document.getElementById("intro-start-btn");

    // Intro
    if (introStartBtn && introModal) {
        introStartBtn.addEventListener("click", () => {
            introModal.classList.add("hidden");
        });
    }

    </script>
</body>
</html>
