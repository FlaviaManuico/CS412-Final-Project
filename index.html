<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cosmic Solar System</title>
    <link rel="stylesheet" href="css/style.css">

    <!-- Matrix & math utilities -->
    <script src="js/transformations.js"></script>

    <!-- ===== VERTEX SHADER ===== -->
    <script id="vs" type="x-shader/x-vertex">#version 300 es
    layout(location = 0) in vec4 aPosition;
    layout(location = 1) in vec3 aNormal;
    layout(location = 2) in vec2 aUV;

    uniform mat4 uModel;
    uniform mat4 uView;
    uniform mat4 uProjection;
    uniform mat4 uNormalMatrix;

    out vec3 vNormal;
    out vec3 vPosition;
    out vec2 vTexCoord;

    void main() {
        vNormal = mat3(uNormalMatrix) * aNormal;
        vPosition = (uModel * aPosition).xyz;
        vTexCoord = aUV;
        gl_Position = uProjection * uView * uModel * aPosition;
    }
    </script>

    <!-- ===== FRAGMENT SHADER ===== -->
    <script id="fs" type="x-shader/x-fragment">#version 300 es
    precision mediump float;

    in vec3 vNormal;
    in vec3 vPosition;
    in vec2 vTexCoord;

    uniform vec3 uLightPos;
    uniform vec3 uColor;
    uniform float uEmissive;

    uniform sampler2D uTexture;
    uniform sampler2D uBumpMap;
    uniform int useTexture;
    uniform int useBump;

    out vec4 fragColor;

    void main() {
        if (uEmissive > 0.5) {
            vec3 baseColor = (useTexture == 1) ? texture(uTexture, vTexCoord).rgb : uColor;
            fragColor = vec4(baseColor * uEmissive, 1.0);
            return;
        }

        vec3 N = normalize(vNormal);
        if (useBump == 1) {
            vec3 bump = texture(uBumpMap, vTexCoord).rgb;
            bump = bump * 2.0 - 1.0;
            N = normalize(N + bump * 0.5);
        }

        vec3 L = normalize(uLightPos - vPosition);
        float diffuse = max(dot(N, L), 0.0);
        float ambient = 0.45;
        float lightFactor = ambient + diffuse * 0.45;

        vec3 texColor = (useTexture == 1) ? texture(uTexture, vTexCoord).rgb : uColor;

        fragColor = vec4(texColor * lightFactor, 1.0);
    }
    </script>
</head>

<body>

    <canvas id="glcanvas"
        style="width: 100vw; height: 100vh; display: block;"></canvas>

    <div class="control-column">
        <button id="cockpit-toggle" class="control-button">
            Enter Cockpit
        </button>

        <button id="game-mode-toggle" class="control-button" disabled>
            Enter Game Mode
        </button>

        <button id="add-asteroids-btn" class="control-button">
            Add Asteroids
        </button>
    </div>

    <!-- Planet Info Panel -->
    <div id="planet-info" style="
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px;
        border-radius: 8px;
        display: none;
        max-width: 250px;
        font-family: Arial, sans-serif;
        z-index: 100;
    ">
        <h3 id="info-name" style="margin: 0 0 5px 0;"></h3>
        <p id="info-text" style="margin: 0;"></p>
        <button id="info-close" style="
            background: red;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 5px;
        ">X</button>
    </div>

    <div id="cockpit-window-frame">
        <div class="cockpit-ring"></div>
    </div>

    <div id="cockpit-joystick">
        <div id="joystick-base"></div>
        <div id="joystick-stick"></div>
    </div>
    <div id="score-board">
        Score: 0
    </div>

    <div id="visual-controls">
        <h3>Visual Controls</h3>
        <!-- Sun Brightness -->
        <div class="slider-row">
            <label>
            <span>Sun Brightness</span>
            <span id="sun-brightness-value">1.8</span>
            </label>
            <input type="range" id="sun-brightness"
                min="0.5" max="5.0" step="0.1" value="1.8">
        </div>

        <!-- Orbit Speed -->
        <div class="slider-row">
            <label>
            <span>Orbit Speed</span>
            <span id="orbit-speed-value">1.0x</span>
            </label>
            <input type="range" id="orbit-speed"
                min="0.2" max="2.0" step="0.1" value="1.0">
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/planets.js"></script>
    <script src="js/scene.js"></script>
    <script src="js/main.js"></script>
    <script src="js/interaction.js"></script>

    <script>
        // Close info panel
        document.getElementById('info-close').addEventListener('click', () => {
            document.getElementById('planet-info').style.display = 'none';
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Sun Brightness
            const sunSlider = document.getElementById('sun-brightness');
            const sunValue = document.getElementById('sun-brightness-value');
            if(sunSlider) {
                sunSlider.addEventListener('input', (e) => {
                    window.sunBrightness = parseFloat(e.target.value);
                    sunValue.textContent = window.sunBrightness.toFixed(1);
                });
            }

        // Orbit Speed
        const orbitSlider = document.getElementById('orbit-speed');
        const orbitValue = document.getElementById('orbit-speed-value');
            if(orbitSlider) {
                orbitSlider.addEventListener('input', (e) => {
                    window.orbitSpeedMultiplier = parseFloat(e.target.value);
                    orbitValue.textContent = window.orbitSpeedMultiplier.toFixed(1) + 'x';
                });
            }
        });
    </script>
</body>
</html>
